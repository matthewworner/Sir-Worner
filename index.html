<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wally Worner and the Siege of Malta</title>
    <!-- Premium Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Chewy&family=Gentium+Book+Plus:ital,wght@0,400;0,700;1,400&display=swap"
        rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #fdf6e3;
            /* Warm parchment */
            font-family: 'Gentium Book Plus', serif;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: #2c1810;
        }

        /* Book Container */
        .book-container {
            width: 100%;
            height: 100%;
            max-width: 1000px;
            /* Constrain max width for desktop */
            background-image: url('https://www.transparenttextures.com/patterns/aged-paper.png'), linear-gradient(to right, #e8dcb9 0%, #fdf6e3 5%, #fdf6e3 95%, #e8dcb9 100%);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5), inset 0 0 100px rgba(93, 64, 55, 0.1);
            position: relative;
            overflow: hidden;
            border-left: 15px solid #5d4037;
            /* Spine */
            border-right: 5px solid #d7ccc8;
        }

        /* Pages */
        .page {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            display: none;
            flex-direction: column;
            padding: 40px 60px 100px 60px;
            animation: fadeIn 0.8s ease-in-out;
            background: transparent;
        }

        .page.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typography */
        h1 {
            font-family: 'Chewy', cursive;
            color: #b71c1c;
            /* Deep red for titles */
            font-size: 48px;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
            line-height: 1.2;
        }

        p {
            font-size: 22px;
            line-height: 1.6;
            margin-bottom: 20px;
            text-align: left;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        strong {
            color: #b71c1c;
        }

        em {
            color: #1a237e;
            /* Navy blue for emphasis */
            font-weight: bold;
        }

        /* Illustrations */
        .illustration {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 20px 0;
            width: 100%;
        }

        .illustration img {
            max-height: 45vh;
            /* Responsive height */
            max-width: 100%;
            object-fit: contain;
            filter: drop-shadow(5px 5px 15px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        /* Interactive Elements */
        .hidden-rabbit {
            position: absolute;
            width: 50px;
            opacity: 0.8;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 100;
        }

        .hidden-rabbit:hover {
            transform: scale(1.2) rotate(-10deg);
        }

        .hidden-rabbit.found {
            transform: scale(3) rotate(360deg);
            opacity: 0;
            pointer-events: none;
            transition: all 1s ease-out;
        }

        /* Animations */
        .anim-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        .anim-shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        .anim-glow {
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from {
                filter: drop-shadow(0 0 5px gold);
            }

            to {
                filter: drop-shadow(0 0 20px gold);
            }
        }

        .anim-sail {
            animation: sail 4s linear infinite alternate;
        }

        @keyframes sail {
            from {
                transform: rotate(-5deg);
            }

            to {
                transform: rotate(5deg);
            }
        }

        .anim-battle {
            animation: battle 0.2s infinite;
        }

        @keyframes battle {
            0% {
                transform: translate(0, 0);
            }

            25% {
                transform: translate(2px, 2px);
            }

            50% {
                transform: translate(-2px, 2px);
            }

            75% {
                transform: translate(-2px, -2px);
            }

            100% {
                transform: translate(2px, -2px);
            }
        }

        .click-wiggle:active {
            animation: wiggle 0.5s linear;
        }

        @keyframes wiggle {

            0%,
            7% {
                transform: rotateZ(0);
            }

            15% {
                transform: rotateZ(-15deg);
            }

            20% {
                transform: rotateZ(10deg);
            }

            25% {
                transform: rotateZ(-10deg);
            }

            30% {
                transform: rotateZ(6deg);
            }

            35% {
                transform: rotateZ(-4deg);
            }

            40%,
            100% {
                transform: rotateZ(0);
            }
        }

        .click-glow:active {
            filter: brightness(1.5) drop-shadow(0 0 20px yellow);
            transition: 0.1s;
        }

        .popped {
            animation: popScale 0.3s ease-out forwards;
        }

        @keyframes popScale {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }

            100% {
                transform: scale(0);
                opacity: 0;
            }
        }

        /* Controls */
        .controls {
            position: absolute;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            z-index: 10;
        }

        button {
            padding: 15px 30px;
            font-family: 'Chewy', cursive;
            font-size: 24px;
            color: white;
            background: #b71c1c;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 0 #7f0000;
            transition: transform 0.1s;
        }

        button:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #7f0000;
        }

        button:disabled {
            background: #ccc;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
        }

        .icon-btn {
            padding: 15px;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            background: #f9a825;
            /* Gold */
            box-shadow: 0 4px 0 #c17900;
        }

        .page-number {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
            color: #5d4037;
            font-weight: bold;
        }

        /* Cover specific */
        .cover-page {
            text-align: center;
            background-image: radial-gradient(circle at center, #fff8e1 0%, #fdf6e3 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .cover-title {
            font-size: 80px;
            color: #b71c1c;
            margin: 0;
            line-height: 1.1;
            text-shadow: 4px 4px 0px rgba(0, 0, 0, 0.1);
        }

        .cover-collage {
            position: relative;
            width: 100%;
            height: 450px;
            /* Specific height for cover */
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cover-main-img {
            max-height: 400px;
            /* Larger hero image */
            z-index: 2;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
        }

        .cover-bg-img {
            position: absolute;
            opacity: 0.6;
            z-index: 1;
        }

        .cover-decoration {
            font-size: 28px;
            font-style: italic;
            color: #555;
            margin-top: 20px;
        }

        .start-btn {
            font-size: 32px;
            padding: 20px 60px;
            margin-top: 30px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        /* Modals */
        .victory-modal,
        .map-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .victory-content,
        .map-content {
            background: #fff8e1;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 10px solid #eda000;
            box-shadow: 0 0 50px gold;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            max-width: 90%;
        }

        @keyframes popIn {
            from {
                transform: scale(0.5);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .victory-rabbit {
            width: 150px;
            margin-bottom: 20px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(-20px);
            }
        }

        .map-base {
            max-width: 100%;
            height: auto;
            border: 5px solid #5d4037;
            border-radius: 10px;
        }

        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 40px;
            color: #5d4037;
            cursor: pointer;
            line-height: 0.5;
        }

        /* Map Markers */
        .map-marker {
            position: absolute;
            cursor: pointer;
            transform: translate(-50%, -50%);
        }

        .map-marker:hover .marker-icon {
            transform: scale(1.5);
        }

        .marker-icon {
            font-size: 40px;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.5));
            transition: transform 0.2s;
        }

        .marker-label {
            background: white;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid #333;
            font-family: sans-serif;
            font-size: 12px;
            white-space: nowrap;
            margin-top: 5px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .map-marker:hover .marker-label {
            opacity: 1;
        }

        .pirate-ship-icon {
            position: absolute;
            font-size: 50px;
            animation: sailAside 5s linear infinite alternate;
        }

        @keyframes sailAside {
            from {
                transform: translateX(0) rotate(-5deg);
            }

            to {
                transform: translateX(20px) rotate(5deg);
            }
        }

        /* Interactive Items Overlay */
        .interactive-overlay {
            position: absolute;
            cursor: pointer;
            z-index: 50;
            transition: transform 0.2s;
        }

        .interactive-overlay:hover {
            transform: scale(1.2);
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .page {
                padding: 20px 20px 100px 20px;
            }

            h1 {
                font-size: 28px;
            }

            .cover-title {
                font-size: 40px;
            }

            .cover-collage {
                height: 300px;
            }

            .cover-main-img {
                height: 200px;
            }

            .controls {
                width: 95%;
                bottom: 10px;
            }

            .text-content p:first-of-type::first-letter {
                font-size: 2.5em;
            }

            .page8-knight {
                display: none;
            }

            .rabbit-counter-panel {
                padding: 5px 10px;
                font-size: 18px;
                top: 10px;
                right: 10px;
            }

            .rabbit-counter-panel img {
                width: 30px;
            }
        }

        .illustration-group {
            position: relative;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }
    </style>
</head>

<body>
    <audio id="snd-turn" src="https://assets.mixkit.co/active_storage/sfx/2045/2045-preview.mp3"></audio>
    <audio id="snd-yay" src="https://assets.mixkit.co/active_storage/sfx/1114/1114-preview.mp3"></audio>
    <audio id="snd-ocean" src="https://assets.mixkit.co/active_storage/sfx/1188/1188-preview.mp3" loop></audio>
    <audio id="snd-sword" src="https://assets.mixkit.co/active_storage/sfx/1271/1271-preview.mp3"></audio>
    <audio id="snd-cannon" src="https://assets.mixkit.co/active_storage/sfx/1703/1703-preview.mp3"></audio>
    <audio id="snd-bells" src="https://assets.mixkit.co/active_storage/sfx/573/573-preview.mp3"></audio>
    <audio id="snd-pop" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>
    <audio id="snd-siren" src="https://assets.mixkit.co/active_storage/sfx/543/543-preview.mp3"></audio>
    <audio id="snd-plane" src="https://assets.mixkit.co/active_storage/sfx/936/936-preview.mp3"></audio>

    <div class="rabbit-counter-panel"
        style="position: fixed; top: 10px; right: 20px; z-index: 151; background: #fff8e1; border: 2px solid #5d4037; border-radius: 20px; padding: 5px 15px; font-family: 'Chewy', cursive; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 5px rgba(0,0,0,0.2);">
        <img src="assets/images/rabbit.png" alt="Rabbit" style="width: 40px;"> <span id="rabbit-count">0/8 Found</span>
    </div>

    <div style="position: fixed; top: 20px; left: 20px; z-index: 150;">
        <select id="bookSelect" onchange="changeBook(this.value)"
            style="padding: 10px; font-family: 'Chewy'; font-size: 20px; border-radius: 10px; background: #FFD700; border: 3px solid #5d4037; color: #5d4037; cursor: pointer; box-shadow: 0 4px 5px rgba(0,0,0,0.3);">
            <option value="book1">Book 1: Siege of Malta (1565)</option>
            <option value="book2">Book 2: Fortress Malta (1940)</option>
        </select>
    </div>

    <div class="game-tip" id="gameTip"
        style="display: none; position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #fff; padding: 15px 30px; border-radius: 50px; box-shadow: 0 10px 20px rgba(0,0,0,0.2); z-index: 160; animation: bounce 2s infinite;">
        <strong>Psst!</strong> Help Wally find the hidden rabbits on each page! üê∞
    </div>

    <div class="book-container">
        <!-- BOOK 1 PAGES (Original) -->
        <div class="page cover-page active book1-page">
            <h1 class="cover-title">Wally Worner<br>and the<br>Siege of Malta</h1>

            <div class="cover-collage">
                <img src="assets/images/castle.png" class="cover-bg-img"
                    style="left: 10%; top: 20%; transform: rotate(-10deg); width: 150px;">
                <img src="assets/images/ship.png" class="cover-bg-img"
                    style="right: 10%; top: 30%; transform: rotate(10deg); width: 150px;">
                <img src="assets/images/rabbit.png" class="cover-bg-img"
                    style="bottom: 10%; right: 20%; width: 80px; opacity: 1;">

                <img src="assets/images/worner.png?v=2" alt="Wally Worner" class="cover-main-img">
            </div>

            <p class="cover-decoration">A Tale of Courage, Honor, and Rabbits</p>

            <button class="start-btn" onclick="nextPage()">Start Reading</button>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 85px; left: 30px; transform: rotate(10deg);" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="assets/images/worner.png?v=2" alt="Wally Worner" class="anim-float click-wiggle">
            </div>
            <div class="text-content">
                <h1>Wally Worner and the Siege of Malta</h1>
                <p><strong>A Tale of Courage and Honor</strong></p>
                <p style="margin-top: 20px;">Long ago in 1565, there lived a brave knight named Wally Worner. His name
                    meant "guardian warrior," and he carried a bright yellow shield with a bold red stripe and six red
                    flowers.</p>
                <p style="margin-top: 15px;">He was never alone! Always by his side were his trusty squires:
                    <strong>Marco</strong>, <strong>Seraphine</strong>, and <strong>Lola</strong>.
                </p>
                <p style="margin-top: 15px;">His family motto was: <em>"Non nobis tantum nati"</em> ‚Äî "Not born for
                    ourselves alone." It meant they lived to help others!</p>
            </div>
            <div class="page-number">1</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 20px; left: 40px; transform: rotate(-20deg);" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'sails')">
                <img src="assets/images/castle.png" alt="Fort St Angelo" class="anim-glow"
                    style="width: 45%; margin-right: 10px;">
                <img src="assets/images/real_stella/staircase.jpg" alt="Attic Stairs" class="anim-glow"
                    style="border: 5px solid #fff; width: 45%;">
            </div>
            <div class="text-content">
                <h1>The Attic Discovery</h1>
                <p>One sunny morning, Wally was exploring the dusty attic of his home, fittingly called
                    <strong>"Stella"</strong> (The Star) in the town of Senglea.</p>
                <p style="margin-top: 15px;">He found an old wooden chest. Inside was a dusty scroll!</p>
                <p style="margin-top: 15px;">"Look Squires!" he shouted. "It's a map of secret tunnels beneath our
                    house!"</p>
                <p style="margin-top: 15px;">The squires Marco and Seraphine gasped. Little Lola just chewed on a toy
                    shield.</p>
            </div>
            <div class="page-number">2</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 120px; right: 50px; transform: rotate(15deg);" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="assets/images/worner.png?v=2" alt="Wally Training" class="click-wiggle">
            </div>
            <div class="text-content">
                <h1>Training Day</h1>
                <p>Before they could explore, they had to train.</p>
                <p style="margin-top: 15px;"><em>Clang! Clang!</em> went their wooden swords.</p>
                <p style="margin-top: 15px;">"Good work, Marco!" Wally cheered. "Keep your shield up, Seraphine!"</p>
                <p style="margin-top: 15px;">They practiced defending the "fortress" (which was actually the kitchen
                    table). Nanna gave them warm pastizzi for energy.</p>
            </div>
            <div class="page-number">3</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 80px; left: 80px; transform: rotate(45deg);" onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 80px; left: 40px; font-size: 50px;"
                onclick="fireCannon(this)" title="Fire Cannon!">üí£</div>
            <div class="illustration" onclick="animateElement(this, 'sail')">
                <img src="assets/images/ship.png" alt="Pirate Ships" class="anim-sail">
            </div>
            <div class="text-content">
                <h1>The Great Siege Begins!</h1>
                <p>Suddenly, bells rang out from the church! <em>Ding! Dong! Ding! Dong!</em></p>
                <p style="margin-top: 15px;">"Pirates!" cried Wally. "Thousands of them!"</p>
                <p style="margin-top: 15px;">The horizon was filled with red sails. The Ottoman Empire had come to take
                    their island.</p>
                <p style="margin-top: 15px;">"To the walls!" shouted Wally. "For Malta! For Stella!"</p>
                <p style="margin-top: 10px; font-size: 16px; color: #555;">(Tap the bomb to fire the cannons!)</p>
            </div>
            <div class="page-number">4</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 50px; left: 20px; transform: rotate(-5deg);" onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="top: 100px; right: 60px; font-size: 50px;"
                onclick="interactFood(this)" title="Eat Bread">ü•ñ</div>
            <div class="illustration">
                <img src="assets/images/real_stella/kitchen.jpg" alt="Kitchen Shelter" class="click-wiggle"
                    style="border: 5px solid #fff; opacity: 0.9;">
            </div>
            <div class="text-content">
                <h1>Hungry Defenders</h1>
                <p>The siege lasted for months. It was hot and scary.</p>
                <p style="margin-top: 15px;">"I'm hungry," said Lola.</p>
                <p style="margin-top: 15px;">"We must share," said Wally. He divided their last loaf of bread into four
                    equal pieces.</p>
                <p style="margin-top: 15px;"><em>"Non nobis tantum nati,"</em> he reminded them. Even in the darkest
                    times, kindness was their strongest weapon.</p>
            </div>
            <div class="page-number">5</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 30px; right: 30px; transform: rotate(90deg);" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'glow')">
                <img src="assets/images/fortress.png" alt="Fortress Walls" class="anim-glow">
            </div>
            <div class="text-content">
                <h1>Holding the Line</h1>
                <p>The pirates attacked again and again. BOOM! CRASH!</p>
                <p style="margin-top: 15px;">But the walls of Senglea held firm. Wally and his squires threw stones and
                    boiling water (from the laundry) to drive them back.</p>
                <p style="margin-top: 15px;">"They shall not pass!" roared Wally.</p>
            </div>
            <div class="page-number">6</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 60px; right: 60px; transform: rotate(-10deg);" onclick="foundRabbit(this)">
            <div class="interactive-overlay"
                style="top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 80px;"
                onclick="playSound('yay')" title="Victory!">üèÜ</div>
            <div class="illustration" onclick="animateElement(this, 'shake')">
                <img src="assets/images/map_malta.png" alt="Victory Map" class="click-wiggle">
            </div>
            <div class="text-content">
                <h1>Victory!</h1>
                <p>Finally, on the 8th of September, the pirate ships turned around and sailed away.</p>
                <p style="margin-top: 15px;">"Hooray!" cheered the people of Malta.</p>
                <p style="margin-top: 15px;">"We did it!" hugged Seraphine. "We saved Stella!"</p>
                <p style="margin-top: 15px;">The Grand Master gave Wally a medal. "You are a true hero, Sir Worner."</p>
            </div>
            <div class="page-number">7</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 20px; left: 50%; transform: translateX(-50%);" onclick="foundRabbit(this)">
            <div class="illustration">
                <div class="illustration-group">
                    <img src="assets/images/worner.png?v=2" alt="Knight Wally" class="page8-knight click-wiggle">
                    <img src="assets/images/real_stella/bedroom.jpg" alt="Real Stella Bedroom"
                        class="page8-house click-glow" style="border: 5px solid white; width: 60%; height: auto;">
                </div>
            </div>
            <div class="text-content">
                <h1>The Legacy</h1>
                <p>Wally Worner grew old and happy in the house called Stella.</p>
                <p style="margin-top: 15px;">He taught his children and grandchildren to always be brave and kind.</p>
                <p style="margin-top: 15px;">And to this day, if you visit 38 Triq il-Kurcifiss in Senglea, you can
                    still see the house that Wally defended.</p>
                <p style="font-size: 16px; color: #555; text-align: center; margin-top: 10px;">(That's the real bedroom
                    of Stella in the photo!)</p>
            </div>
            <div class="page-number">8</div>
        </div>


        <!-- BOOK 2 PAGES (WWII - FULL STORY) -->
        <div class="page cover-page book2-page">
            <h1 class="cover-title" style="color: #1a237e; text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.6);">Wally
                Worner<br>and<br>Fortress Malta</h1>
            <div class="cover-collage">
                <img src="assets/images/spitfire.png" class="cover-bg-img"
                    style="left: 10%; top: 20%; transform: rotate(-10deg); width: 150px; filter: grayscale(100%) sepia(0.5);">
                <img src="assets/images/stella_interior.png" class="cover-bg-img"
                    style="right: 15%; top: 30%; transform: rotate(10deg); width: 200px; border: 5px solid white; box-shadow: 0 5px 10px rgba(0,0,0,0.3);">
                <img src="assets/images/young_wally.png" alt="Wally Worner Jr." class="cover-main-img"
                    style="filter: sepia(0.3);">
            </div>
            <p class="cover-decoration" style="color: #1a237e;">A Story of 1940, Courage, and the George Cross</p>
            <button class="start-btn" style="background: #1a237e; box-shadow: 0 6px 0 #0d47a1;"
                onclick="nextPage()">Start Adventure</button>
        </div>

        <!-- PAGE 1: PROLOGUE -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 85px; left: 30px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <img src="assets/images/real_stella/staircase.jpg" alt="Attic Stairs" class="anim-glow"
                    style="border: 5px solid #fff; width: 45%; float: left; margin-right: 10px;">
                <img src="assets/images/young_wally.png" alt="Young Wally 1940" class="anim-glow"
                    style="width: 45%; float: right;">
            </div>
            <div class="text-content">
                <h1>Discovery in the Attic</h1>
                <p>June 1940. Twelve-year-old Wally Worner climbed into the dusty attic of Stella at 38 Triq
                    il-Kurcifiss.</p>
                <p style="margin-top: 15px;">Hidden behind a chest, he found an ancient shield! Yellow with a red stripe
                    and six red roses. The motto read: <em>"Non nobis tantum nati."</em></p>
                <p style="margin-top: 15px;">"That belonged to Sir Wally Worner," his grandmother said. "He defended
                    this house in 1565. It means 'We are not born for ourselves alone.'"</p>
                <p style="margin-top: 15px;">Suddenly, a siren wailed. <em>"Wooooooo!"</em> The war had come to Malta.
                </p>
            </div>
            <div class="page-number">1</div>
        </div>

        <!-- PAGE 2: CHAPTER 1 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 20px; right: 30px;"
                onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'shake')">
                <img src="assets/images/battle.png" alt="Air Raid" class="anim-float" style="filter: grayscale(0.2);">
            </div>
            <div class="text-content">
                <h1>The First Bombs Fall</h1>
                <p>Italian bombers appeared over Grand Harbour. Wally stood on the roof, watching three tiny biplanes
                    rise to meet them.</p>
                <p style="margin-top: 15px;">"Faith, Hope, and Charity," his father pointed. "Three old planes against
                    the whole enemy air force!"</p>
                <p style="margin-top: 15px;">The little Gladiators fought like angry wasps. Wally touched the image of
                    the shield in his pocket. "If the first Wally defended Stella with a sword, I can defend it now."
                </p>
            </div>
            <div class="page-number">2</div>
        </div>

        <!-- PAGE 3: CHAPTER 2 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 120px; left: 40px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <img src="assets/images/real_stella/kitchen.jpg" alt="Kitchen Shelter" class="click-wiggle"
                    style="border: 5px solid #fff; opacity: 0.9;">
            </div>
            <div class="text-content">
                <h1>Life Under Siege</h1>
                <p>Senglea carved deep shelters into the rock. There, Wally met Laurence Mizzi, a boy who looked scared
                    and hungry.</p>
                <p style="margin-top: 15px;">"I suffer more from hunger than bombs," Laurence whispered.</p>
                <p style="margin-top: 15px;">Wally broke his last piece of bread in half. "Here. We share everything.
                    That's what friends do."</p>
                <p style="margin-top: 15px;">Grandmother made stew from their last rabbit. "This gave the first Wally
                    strength," she said. "It will give us strength too."</p>
            </div>
            <div class="page-number">3</div>
        </div>

        <!-- PAGE 4: CHAPTER 3 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 50px; left: 20px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <img src="assets/images/mary_ellul.png" alt="Mary Ellul" class="anim-glow"
                    style="width: 50%; margin: 0 auto; display: block;">
            </div>
            <div class="text-content">
                <h1>Heroes of Malta</h1>
                <p>"Not all heroes carry guns," Grandmother told the children.</p>
                <p style="margin-top: 15px;">She spoke of <strong>Mary Ellul</strong> ("Mary the Man"), the Air Raid
                    Warden who lifted heavy beams to save neighbors. Of <strong>Mabel Strickland</strong>, who printed
                    <em>The Times of Malta</em> every day despite the bombs.</p>
                <p style="margin-top: 15px;">"And <strong>Henrietta Chevalier</strong>," she whispered. "Hiding refugees
                    in Rome right under the enemy's nose. They live our motto: Not born for ourselves alone."</p>
            </div>
            <div class="page-number">4</div>
        </div>

        <!-- PAGE 5: CHAPTER 4 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 50px; right: 50px;"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 60px; right: 40px; font-size: 60px;"
                onclick="playSound('plane')" title="Spitfire Flyby!">‚úàÔ∏è</div>
            <div class="illustration" onclick="animateElement(this, 'sail')">
                <img src="assets/images/spitfire.png" alt="Spitfire" class="anim-sail">
            </div>
            <div class="text-content">
                <h1>The Falcon Arrives</h1>
                <p>April 1942. A roar filled the sky! <strong>Spitfires!</strong></p>
                <p style="margin-top: 15px;">They were led by <strong>Sir Keith Park</strong>, a tall New Zealander who
                    commanded the defense. Pilots from Canada, Australia, and New Zealand flew to save Malta.</p>
                <p style="margin-top: 15px;">Wally met a Canadian pilot named <strong>Buzz Beurling</strong>. "You spot
                    'em, kid, I'll shoot 'em," Buzz grinned. The Falcon of Malta had arrived!</p>
            </div>
            <div class="page-number">5</div>
        </div>

        <!-- PAGE 6: CHAPTER 5 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 30px; right: 40px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <img src="assets/images/salvo.png" alt="Salvo" class="anim-glow"
                    style="width: 45%; float: left; margin-right: 10px;">
                <img src="assets/images/real_stella/window_view.jpg" alt="Window" class="anim-battle"
                    style="width: 45%; border: 5px solid white;">
            </div>
            <div class="text-content">
                <h1>Stella Under Fire</h1>
                <p><em>Boom!</em> A bomb landed on Triq il-Kurcifiss. Stella was hurt. Her windows were blown out.</p>
                <p style="margin-top: 15px;">But neighbors came to help. <strong>Salvo</strong>, a master carpenter,
                    arrived with his tools. "This house is special," he said.</p>
                <p style="margin-top: 15px;">He crafted beautiful new timber frames. "This is my way of fighting," Salvo
                    smiled. "By building." Wally realized that kindness was a weapon too.</p>
            </div>
            <div class="page-number">6</div>
        </div>

        <!-- PAGE 7: CHAPTER 6 & 7 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 100px; left: 20px;"
                onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'sail')">
                <img src="assets/images/ship.png" alt="SS Ohio" class="anim-sail" style="filter: sepia(0.6);">
            </div>
            <div class="text-content">
                <h1>Operation Pedestal</h1>
                <p>Malta was starving. But in August 1942, the broken tanker <strong>SS Ohio</strong> limped into Grand
                    Harbour, carried by two destroyers. She brought fuel and survival.</p>
                <p style="margin-top: 15px;">"We made it!" Laurence cheered.</p>
                <p style="margin-top: 15px;">The tide turned. King George VI awarded the <strong>George Cross</strong>
                    to the whole island. Wally pinned a paper cross to his shirt, proud to be Maltese.</p>
            </div>
            <div class="page-number">7</div>
        </div>

        <!-- PAGE 8: CHAPTER 8 -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 40px; right: 20px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <img src="assets/images/stella_interior.png" alt="Stella Interior" class="anim-glow">
            </div>
            <div class="text-content">
                <h1>Stella Still Shines</h1>
                <p>The war ended. Wally and his father repaired Stella's walls. Salvo returned to finish the beautiful
                    woodwork.</p>
                <p style="margin-top: 15px;">Grandmother hung the old shield back on the wall. "Two Wallys," she said.
                    "Two sieges. One house."</p>
                <p style="margin-top: 15px;">Wally looked at Laurence. "We did it. We defended Stella. Together."</p>
            </div>
            <div class="page-number">8</div>
        </div>

        <!-- PAGE 9: EPILOGUE -->
        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 20px; left: 20px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <div class="illustration-group">
                    <img src="assets/images/young_wally.png" alt="Young Wally" class="page8-knight click-wiggle">
                    <img src="assets/images/real_stella/bedroom.jpg" alt="Real Bedroom" class="page8-house click-glow"
                        style="border: 5px solid white; width: 60%; height: auto;">
                </div>
            </div>
            <div class="text-content">
                <h1>The Legacy Continues</h1>
                <p>Years later, a young boy touched the smooth timber window frames at Stella.</p>
                <p style="margin-top: 15px;">"Salvo made those," Old Wally told his grandson. "During the war."</p>
                <p style="margin-top: 15px;">"Real heroism isn't just fighting," Old Wally said. "It's Mary saving
                    neighbors. Mabel printing truth. Salvo building windows. It's living for others."</p>
                <p style="margin-top: 15px;">Stella the Star still shines‚Äîbecause love is the strongest stone of all.
                </p>
                <p style="font-size: 16px; color: #555; text-align: center; margin-top: 10px;">(You can see the real
                    bedroom of Stella!)</p>
            </div>
            <div class="page-number">9</div>
        </div>

        <div class="controls">
            <button id="prevBtn" onclick="previousPage()">‚Üê Previous</button>
            <button id="mapBtn" class="icon-btn" onclick="toggleMap()">üó∫Ô∏è</button>
            <button id="sndBtn" class="icon-btn" onclick="toggleSound()">üîä</button>
            <button id="nextBtn" onclick="nextPage()">Next ‚Üí</button>
        </div>
    </div>

    <!-- Map Modal -->
    <div class="map-modal" id="mapModal">
        <div class="map-content" id="mapContent">
            <div class="close-btn" onclick="toggleMap()">√ó</div>
            <img src="assets/images/map_malta.png" class="map-base" alt="Map of Malta">

            <!-- Markers -->
            <div class="map-marker" style="top: 55%; left: 52%;" onclick="zoomMap('senglea')">
                <div class="marker-icon">‚≠ê</div>
                <div class="marker-label">Stella House (Senglea)</div>
            </div>

            <div class="map-marker" style="top: 45%; left: 60%;" onclick="zoomMap('birgu')">
                <div class="marker-icon">üè∞</div>
                <div class="marker-label">Fort St. Angelo</div>
            </div>

            <!-- Enemies -->
            <div class="pirate-ship-icon" style="bottom: 20%; left: 10%;" title="Enemy Fleet">‚öì</div>
            <div class="pirate-ship-icon" style="bottom: 30%; left: 80%; animation-delay: 2s;" title="Enemy Fleet">‚öì
            </div>

            <p style="margin-top: 10px; font-family: 'Chewy'; font-size: 20px;">Use the Map to explore the Siege!</p>
        </div>
    </div>

    <div class="map-modal" id="photoModal" onclick="closePhoto()">
        <div class="victory-content" style="max-width: 80vh; width: auto; background: #fff; padding: 20px;">
            <div class="close-btn" style="top: -20px; right: -20px;" onclick="closePhoto()">√ó</div>
            <h2 id="photoCaption" style="font-size: 30px; margin-bottom: 10px;">Real Life Stella</h2>
            <img id="realPhotoImg" src=""
                style="max-width: 100%; max-height: 60vh; border-radius: 10px; border: 5px solid #5d4037;">
        </div>
    </div>

    <!-- Victory Modal -->
    <div class="victory-modal" id="victoryModal">
        <div class="victory-content" id="victoryContent">
            <div class="close-btn" style="top: -20px; right: -20px;" onclick="closeVictory()">√ó</div>
            <h2>Rabbit Hero!</h2>
            <img src="assets/images/rabbit.png" class="victory-rabbit" alt="Happy Rabbit">
            <p style="font-size: 24px;">You found all hidden rabbits!</p>
            <p>The Knights of Malta salute your keen eyes!</p>
        </div>
    </div>

    <script>
        let currentBook = 'book1';
        let currentPage = 0;
        let totalPages = 0;
        let soundEnabled = true;
        let rabbitCount = 0;
        let totalRabbits = 8; // Default Book 1

        // Sound Elements
        const sounds = {
            turn: document.getElementById('snd-turn'),
            yay: document.getElementById('snd-yay'),
            ocean: document.getElementById('snd-ocean'),
            sword: document.getElementById('snd-sword'),
            cannon: document.getElementById('snd-cannon'),
            bells: document.getElementById('snd-bells'),
            pop: document.getElementById('snd-pop'),
            siren: document.getElementById('snd-siren'),
            plane: document.getElementById('snd-plane')
        };

        function init() {
            // Initial setup using URL param if exists, else book1
            changeBook('book1');
        }

        function changeBook(bookName) {
            currentBook = bookName;
            currentPage = 0;

            // Reset Rabbits
            if (currentBook === 'book2') {
                totalRabbits = 9;
            } else {
                totalRabbits = 8;
            }
            rabbitCount = 0;
            updateRabbitCounter();
            // Reset rabbit visuals
            document.querySelectorAll('.found').forEach(el => el.classList.remove('found'));
            document.getElementById('victoryModal').style.display = 'none';

            // Re-query only relevant pages to determine count
            const bookPages = document.querySelectorAll('.' + currentBook + '-page');
            totalPages = bookPages.length;

            updateDisplay();
        }

        function updateRabbitCounter() {
            document.getElementById('rabbit-count').innerText = rabbitCount + "/" + totalRabbits + " Found";
        }

        function updateDisplay() {
            const allPages = document.querySelectorAll('.page');
            allPages.forEach(p => p.style.display = 'none');
            allPages.forEach(p => p.classList.remove('active'));

            const bookPages = document.querySelectorAll('.' + currentBook + '-page');

            if (bookPages[currentPage]) {
                bookPages[currentPage].style.display = 'flex';
                // Trigger reflow for animation
                setTimeout(() => bookPages[currentPage].classList.add('active'), 10);
            }

            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').innerText = currentPage === totalPages - 1 ? 'Finish' : 'Next ‚Üí';
        }

        function nextPage() {
            if (currentPage < totalPages - 1) {
                currentPage++;
                playSound('turn');
                updateDisplay();
            }
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                playSound('turn');
                updateDisplay();
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sndBtn').innerText = soundEnabled ? 'üîä' : 'üîá';
            if (soundEnabled) {
                if (currentPage === 0) tryPlayOcean();
            } else {
                sounds.ocean.pause();
            }
        }

        function playSound(name) {
            if (!soundEnabled) return;
            if (sounds[name]) {
                sounds[name].currentTime = 0;
                sounds[name].play().catch(e => console.log("Audio play failed / user interaction needed"));
            }
        }

        function tryPlayOcean() {
            sounds.ocean.volume = 0.3;
            sounds.ocean.play().catch(e => { });
        }

        // Rabbit Game
        function foundRabbit(element) {
            if (element.classList.contains('found')) return;

            element.classList.add('found');
            rabbitCount++;
            updateRabbitCounter();
            playSound('pop');

            if (rabbitCount === totalRabbits) {
                setTimeout(() => {
                    document.getElementById('victoryModal').style.display = 'flex';
                    playSound('yay');
                    playSound('bells');
                }, 500);
            }
        }

        function closeVictory() {
            document.getElementById('victoryModal').style.display = 'none';
        }

        // Map
        function toggleMap() {
            const modal = document.getElementById('mapModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function zoomMap(location) {
            alert("This place was vital during the " + (currentBook === 'book1' ? "Great Siege of 1565!" : "Second Siege of 1940!"));
        }

        function showRealPhoto(src, caption) {
            const modal = document.getElementById('photoModal');
            document.getElementById('realPhotoImg').src = src;
            document.getElementById('photoCaption').innerText = caption;
            modal.style.display = 'flex';
        }

        function closePhoto() {
            document.getElementById('photoModal').style.display = 'none';
        }

        // Interaction
        function animateElement(element, animationClass) {
            element.classList.remove(animationClass);
            void element.offsetWidth; // trigger reflow
            element.classList.add(animationClass);
        }

        function interactFood(element) {
            animateElement(element, 'popped');
            playSound('pop');
            setTimeout(() => {
                element.style.opacity = '0';
                element.style.pointerEvents = 'none';
            }, 200);
        }

        function fireCannon(element) {
            animateElement(element, 'popped');
            playSound('cannon');
            // Shake the screen
            document.body.style.animation = "shake 0.5s";
            setTimeout(() => document.body.style.animation = "", 500);
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') previousPage();
        });

        // Start
        init();

        // Show game tip
        setTimeout(() => {
            document.getElementById('gameTip').style.display = 'block';
            setTimeout(() => {
                document.getElementById('gameTip').style.display = 'none';
            }, 5000);
        }, 1000);
    </script>
</body>

</html>